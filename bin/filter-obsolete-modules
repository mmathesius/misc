#!/usr/bin/python3

import sys

mod_status = {}

def main (arguments):
    # loop through the output from list-fedora-mbs-modules, which is assumed to
    # be in module ID sorted order (eg., oldest build first), saving the latest
    # valid state for each module stream
    for line in sys.stdin:
        line = line.rstrip()
        (name, stream, version, context, scratch, id, state) = line.split(':')

        # Note: possible module states are:
        #     init, wait, build, done, failed, ready, garbage

        # ignore scratch builds
        if scratch == 'true':
            continue

        modstream = ':'.join([name, stream])

        if modstream not in mod_status:
            mod_status[modstream] = 'seen'
        
        if state == 'ready':
            mod_status[modstream] = 'active'

    # list all obsolete module streams
    for mod, status in mod_status.items():
        if status == 'active':
            continue
        print("{}".format(mod))

if __name__ == '__main__':
    sys.exit (main (sys.argv[1:]))
